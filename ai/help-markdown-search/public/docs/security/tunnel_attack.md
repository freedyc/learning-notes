DNS隧道是一种通过DNS协议进行数据传输的技术，它可以将非法的数据流量伪装成正常的DNS查询，从而实现绕过网络安全防护的目的。解析进程仅在递归环节时先查询隧道模块，如隧道模块判断为隧道请求，隧道攻击防护功能通过系统内置的隧道特征库信息检测并拦截异常的DNS请求，中断递归流程；若非隧道请求，则继续后续递归流程，以减少隧道模块对解析性能的影响及防止误拦截本地权威域名请求。

**查询：**  
按照查询文本框灰色字体提示输入要查询的设备名称，点击[查询]按钮，系统会将查询结果在隧道攻击防护列表中显示，只要完全包含所查关键词的内容都会显示出来，以方便管理员进行下一步操作，默认情况和空查询的结果为全部内容。

**隧道攻击防护列表：**  
以列表的形式显示隧道攻击防护信息。信息相关内容包括设备名称、是否启用、防护模式、阻断策略、双因子匹配、动态阻断有效期（秒）、监测统计周期（秒）、最大监测会话数、最大监测区数量。

**实时防护详情：**  
单击该按钮，进入到实时防护详情界面。

**黑白名单设置：**  
根据域名的请求信息判断是否进行隧道防护判断。
- IP白名单： 选择地址调度对象，需提前创建，若请求的源IP为该名单内IP，则直接放行，不进行隧道防护判断，非IP白名单内的请求源IP继续进行后面的隧道防护判断。主要用于来源为DNS服务器的场景，例如缓存递归分离。
- 域名白名单： 选择域名调度对象，需提前创建，若请求的域名为名单内域名，则直接放行，不进行隧道防护判断。域名白名单为区概念，例如test.com会匹配test.com下所有域名。非域名黑白名单的请求域名继续后面的隧道防护判断。
- 域名黑名单： 选择域名调度对象，需提前创建，若请求的域名为黑名单内域名，则直接返回隧道防护。域名黑名单为区概念，例如test.com会匹配test.com下所有域名。非域名黑白名单的请求域名继续后面的隧道防护判断。
- 域名灰名单： 仅在点开更多设置时可见，选择域名调度对象，需提前创建，域名灰名单为区概念，例如test.com会匹配test.com下所有域名。主要作用是保证名单内的区不会被隧道功能全局拉黑（未开启双因子匹配场景下），配置了灰名单的区，即使未启用双因子匹配，也只会基于具体攻击IP进行拉黑，而不会全局拉黑灰名单中的区。

**升级：**  
提供对系统内置的隧道特征库进行升级，升级的库文件请联系厂商。

**编辑：**  
默认不可用，选中节点可用。主要用于隧道攻击防护参数配置。
- 设备名称： 待配置隧道攻击防护功能的设备，不可修改。
- 是否启用： 节点是否启用隧道攻击防护功能。默认否，当为否时，隐藏其他隧道配置。
- 防护模式： 对隧道攻击流量的防护模式，默认为告警+阻断，可选告警或告警+阻断。
- 阻断策略： 当防护选择有阻断时，配置此参数，可选丢弃和应答Servfail。丢弃：表示直接丢弃本次请求，不应答。应答Servfail：表示直接返回Servfail应答结果。
- 双因子匹配： 默认为是，启用后为请求域名（区）+请求源IP同时匹配拦截，用于降低误拦截影响以及防范隧道功能被恶意利用，不启用时只对请求域名进行匹配拦截。
- 动态阻断有效期（秒）： 隧道模块根据系统内置的隧道特征库信息检测请求域名或请求源，如果异常则添加进动态黑名单，此处设置动态黑名单的有效期，超过该时间将从动态黑名单中移出，单位为秒，范围为60-86400，默认值为300。
- 监测统计周期（秒）： 隧道模块对DNS解析请求进行监测统计的周期，单位为秒，范围为60-600，默认值为60。
- 最大监测会话数： 隧道模块在统计周期内支持监测DNS解析请求的最多请求源地址数量，范围为1-65535，默认值为65535。
- 最大监测区数量： 隧道模块在统计周期内支持监测DNS解析请求的最多区数量，范围为1-4096，默认值为4096。
- 允许误差特征数： 在触发的隧道特征数量不超过该数量情况下不判定为隧道攻击行为，反之，若触发的隧道特征数量超过了该值则会被判定为隧道攻击行为，范围为0-10，默认为1。
- 字符串分布概率特征： 根据齐夫定律，自然语言词频会集中于某些小子集中，高频词到低频词的频率逐渐下降，而DNS隧道域名由于进行了特定编码处理，因此不符合该定律，其词频分布相对更平稳，该特征基于对域名词频分布概率统计识别隧道攻击。可根据需要设置是否启用该特征。
- 允许误差阈值（个）： 系统内置字符的分布概率，此处配置允许出现的分布概率偏差较大的字符数量，超出该数量会被判定为隧道攻击。
- 最小样本数（个）： 满足统计要求的最少字符样本数量（区下子域名累计字符数），未达到前，不进行判定。
- 请求类型分布概率特征： DNS不同类型的请求频率分布存在统计学规律，该特征基于客户端对不同类型的请求频率分布统计识别隧道攻击。可根据需要设置是否启用该特征。
- 允许误差阈值（个）： 系统内置不同类型的DNS解析请求的分布概率，此处配置允许出现的分布概率偏差较大的类型数量，超出该数量会被判定为隧道攻击。
- 最小样本数（个）： 满足统计要求的最少请求查询样本数量，未达到前，不进行判定。
- 请求响应比特征： 正常DNS请求与响应的载荷比会保持一定区间内，而隧道流量因侧重于实现某一特定目的，会突破该比例区间，因此可以基于DNS请求响应载荷比的统计分布来识别隧道攻击。可根据需要设置是否启用该特征。
- 比例上限(%)： 合法比例上限。预期正常流量的比例应该在上下限之间，区间外会被判定为隧道攻击。
- 比例下限(%)： 合法比例下限。预期正常流量的比例应该在上下限之间，区间外会被判定为隧道攻击。
- 最小样本数（次）： 满足统计要求的最少请求查询样本数量，未达到前，不进行判定。
- 静态关键字特征： 该特征基于请求域名是否包含特定隧道工具的特征关键字识别隧道攻击。可根据需要设置是否启用该特征。
- 允许误差阈值（个）： 配置包含静态关键字的请求次数，超出该值会被判定为隧道攻击。
- 域名长度特征： 因隧道攻击需要基于域名传递信息，通常其请求域名较长，该特征基于客户端对长域名的请求频率统计识别隧道攻击。可根据需要设置是否启用该特征。
- 前缀长度统计阈值（个）： 统计超过该前缀长度大小的域名请求。
- 允许误差阈值（次）： 此处配置超过允许的长域名的请求次数，超出该数量会被判定为隧道攻击。
- 子域名数量特征： 隧道域的子域名数量远大于正常域，该特征基于域下子域名出现频率识别隧道攻击。可根据需要设置是否启用该特征。
- 允许误差阈值（个）： 配置允许的子域名的数量，超出会被判定为隧道攻击。
